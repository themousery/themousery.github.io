define("render",["lodash","coreUtils","utils","core","reactDOM"],function(a,b,c,d,e){"use strict";var f=typeof window!=="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date);function g(a){if(!window.clientSideRender){require(["warmup"],function(b){a(b)})}}function h(a,b){var c=b.query;var d=c.configName||"fullFunctionality";var e=a[d]||a.fullFunctionality;var f=e.getConfig();if(!c.dsOrigin){throw new Error("You must define dsOrigin parameter in order to use the documentServices - please speak to html-server team for a key")}f.origin=c.dsOrigin;return f}function i(b,d,e){var f=a(e).keys().pull("masterPage").value();return a.mapValues(e,function(a,e){if(d&&window.pagesData&&window.pagesData[e]){return a}return c.dataFixer.fix(a,f.slice(),b.requestModel,b.currentUrl,b.urlFormatModel,b.viewMode==="site",b.rendererModel.clientSpecMap)})}function j(b,c,h,i,j){g(function(a){a.willRender(c)});d.renderer.renderSite(c,h,i,function(d){if(window.rendered){window.rendered.forceUpdate()}else{var h=window.document.getElementById("SITE_CONTAINER").children[0];window.rendered=e.render(d,window.document.getElementById("SITE_CONTAINER"));var i=window.document.getElementById("SITE_CONTAINER").children[0];g(function(a){window.sssr.success=h===i;window.sssr.clientSideRender={sinceInitialTimestamp:Date.now()-window.wixBiSession.initialTimestamp,performanceNow:f()};window.sssr.clientMarkup=i.innerHTML;if(window.parent){if(window.sssr.success){window.parent.postMessage("sssrSuccess","*")}else{window.parent.postMessage({sssrFail:{clientMarkup:window.sssr.clientMarkup,serverMarkup:window.sssr.serverMarkup}},"*")}}a.didRender(c)});window.onpopstate=window.rendered.onPopState;window.onhashchange=window.rendered.onHashChange;if(window.parent){window.rendered.registerAspectToEvent("siteReady",function(){if(j){j(window.rendered)}if(window.documentServices){window.parent.postMessage("documentServicesLoaded","*")}})}if(b.qaAutomation){a.set(window,"testApi.domSelectors",b.qaAutomation.getDomSelectors(b.react,b.reactDOM));window.testApi.domSelectors.setSearchRoot(window.rendered);a.set(window,"testApi.isReady",true)}}})}function k(c,e,f){var g={};if(b.urlUtils.isQueryParamOn(f.currentUrl,"isSantaEditor")){g=a.assign(g,{componentViewMode:"editor"})}if(f.rendererModel.previewMode){g=a.assign(g,{isSocialInteractionAllowed:false,isPlayingAllowed:false})}f.renderFlags=a.assign({},f.renderFlags,g);var h=new d.SiteData(f);var i=d.SiteDataAPI.createSiteDataAPIAndDal(h,e);var j=i.siteData;var k=i.siteDataAPI;var l={pointers:i.pointers,displayedDAL:i.displayedDal,siteDataAPI:k};var m=false;return{fullSiteData:h,displayedSiteData:j,siteDataWrapper:i,viewerPrivateServices:l,isServerSideRender:m,siteModel:f,siteDataAPI:k}}function l(b,d,e,f,g){var l=k(b,d,e);var m=b.documentServices;try{if(m&&a.isUndefined(window.karmaIntegration)&&window.parent.FS){c.integrations.fullStory.start()}}catch(a){}if(m){l.siteDataWrapper.dataLoadedRegistrar=l.siteDataAPI.registerDataLoadedCallback.bind(l.siteDataAPI);window.documentServices=new m.Site(h(m.configs,l.siteModel.currentUrl),l.siteDataWrapper,a.partial(i,l.siteModel,l.isServerSideRender),a.partial(j,b,l.displayedSiteData,l.viewerPrivateServices,f));a.set(window,"testApi.documentServices",window.documentServices)}else{var n=l.fullSiteData.pagesData;l.fullSiteData.pagesData=n&&i(l.siteModel,l.isServerSideRender,n);if(n.masterPage){l.siteDataAPI.createDisplayedPage("masterPage")}j(b,l.displayedSiteData,l.viewerPrivateServices,f,g)}}return{clientSide:l}});